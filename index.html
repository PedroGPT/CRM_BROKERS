<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini CRM Broker</title>
    <link rel="stylesheet" href="style.css">
    <!-- Iconos (opcional, usando caracteres o SVGs inline para no depender de librer칤as externas como FontAwesome, aunque Google Fonts para tipograf칤a es aceptable seg칰n reglas, pero el usuario pidi칩 "solo HTML/CSS/JS" sin librer칤as externas. Usar칠 emojis o CSS shapes para iconos para cumplir estrictamente). -->
</head>

<body>

    <!-- Notificaciones / Toast -->
    <div id="toast-container"></div>

    <!-- SECCI칍N DE AUTENTICACI칍N (Oculta por defecto para evitar bloqueos) -->
    <section id="auth-section" class="auth-container hidden">
        <div class="auth-card">
            <h1 id="auth-title">Bienvenido al CRM</h1>
            <p id="auth-message">Por favor, configura tu contrase침a de acceso.</p>

            <form id="auth-form">
                <div class="form-group">
                    <label for="password-input">Contrase침a</label>
                    <input type="password" id="password-input" required placeholder="Tu contrase침a segura">
                </div>
                <!-- Solo se muestra al cambiar contrase침a -->
                <div class="form-group hidden" id="old-password-group">
                    <label for="old-password-input">Contrase침a Actual</label>
                    <input type="password" id="old-password-input" placeholder="Contrase침a actual">
                </div>

                <button type="submit" class="btn btn-primary" id="auth-btn">Guardar Contrase침a</button>
            </form>
        </div>
    </section>

    <!-- SECCI칍N PRINCIPAL DEL CRM (Visible por defecto) -->
    <section id="app-section" class="app-container">

        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <h2>游 Broker CRM v2.0</h2>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-label">Total</span>
                    <span class="stat-value" id="total-brokers">0</span>
                </div>
                <!-- Se pueden a침adir m치s contadores aqu칤 din치micamente -->
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" id="export-btn" title="Exportar Backup">游 Exportar</button>
                <button class="btn btn-secondary" id="import-btn-trigger" title="Importar Backup">游늭 Importar</button>
                <input type="file" id="import-file" accept=".json" style="display: none;">

                <div class="dropdown">
                    <button class="btn btn-outline" id="user-menu-btn">游녻 Cuenta</button>
                    <div class="dropdown-content hidden" id="user-menu">
                        <a href="#" id="change-pass-btn">Cambiar Contrase침a</a>
                        <a href="#" id="logout-btn">Cerrar Sesi칩n</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="app-nav">
            <button class="nav-item active" data-view="dashboard">游늵 Tablero</button>
            <button class="nav-item" data-view="vendors">游끽 Vendedores</button>
            <button class="nav-item" data-view="procedures">游늯 Procedimientos</button>
        </nav>

        <!-- VIEW: DASHBOARD (KANBAN) -->
        <div id="view-dashboard" class="view-container active">

            <!-- Toolbar -->
            <div class="toolbar">
                <div class="search-filter">
                    <input type="text" id="search-input" placeholder="游댌 Buscar por nombre, empresa...">
                    <select id="filter-status">
                        <option value="all">Todos los Estados</option>
                        <option value="nuevo">Nuevo</option>
                        <option value="contactado">Contactado</option>
                        <option value="procedimientos">Procedimientos</option>
                        <option value="cerrado">Cerrado</option>
                        <option value="perdido">Perdido</option>
                    </select>
                </div>
                <button class="btn btn-primary" id="add-broker-btn">+ Nuevo Broker</button>
            </div>

            <!-- Kanban Board Area -->
            <main class="board" id="kanban-board">
                <!-- Las columnas se generar치n din치micamente o estar치n est치ticas aqu칤 -->
                <!-- Columna: Nuevo -->
                <div class="column" data-status="nuevo" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="column-header status-nuevo">
                        <h3>Nuevo</h3>
                        <span class="count" id="count-nuevo">0</span>
                    </div>
                    <div class="column-content" id="list-nuevo">
                        <!-- Cards van aqu칤 -->
                    </div>
                </div>

                <!-- Columna: Contactado -->
                <div class="column" data-status="contactado" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="column-header status-contactado">
                        <h3>Contactado</h3>
                        <span class="count" id="count-contactado">0</span>
                    </div>
                    <div class="column-content" id="list-contactado"></div>
                </div>

                <!-- Columna: Procedimientos -->
                <div class="column" data-status="procedimientos" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="column-header status-procedimientos">
                        <h3>Procedimientos</h3>
                        <span class="count" id="count-procedimientos">0</span>
                    </div>
                    <div class="column-content" id="list-procedimientos"></div>
                </div>

                <!-- Columna: Cerrado -->
                <div class="column" data-status="cerrado" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="column-header status-cerrado">
                        <h3>Cerrado</h3>
                        <span class="count" id="count-cerrado">0</span>
                    </div>
                    <div class="column-content" id="list-cerrado"></div>
                </div>

                <!-- Columna: Perdido -->
                <div class="column" data-status="perdido" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="column-header status-perdido">
                        <h3>Perdido</h3>
                        <span class="count" id="count-perdido">0</span>
                    </div>
                    <div class="column-content" id="list-perdido"></div>
                </div>
            </main>
        </div> <!-- End view-dashboard -->

        <!-- VIEW: VENDORS -->
        <div id="view-vendors" class="view-container hidden">
            <div class="toolbar">
                <input type="text" id="search-vendor" placeholder="游댌 Buscar vendedor...">
                <button class="btn btn-primary" id="add-vendor-btn">+ Nuevo Vendedor</button>
            </div>
            <div class="grid-layout" id="vendors-list">
                <!-- Vendor Cards Generated via JS -->
            </div>
        </div>

        <!-- VIEW: PROCEDURES -->
        <div id="view-procedures" class="view-container hidden">
            <div class="toolbar">
                <div class="search-filter">
                    <input type="text" id="search-procedure" placeholder="游댌 Buscar procedimiento...">
                    <select id="filter-procedure-vendor">
                        <option value="all">Todos los Vendedores</option>
                        <!-- Options generated via JS -->
                    </select>
                </div>
                <button class="btn btn-primary" id="add-procedure-btn">+ Nuevo Procedimiento</button>
            </div>
            <div class="list-layout" id="procedures-list">
                <!-- Procedure items Generated via JS -->
            </div>
        </div>
    </section>

    <!-- MODAL BROKER -->
    <div id="broker-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="modal-title">Nuevo Broker</h2>
            <form id="broker-form">
                <input type="hidden" id="broker-id">

                <div class="form-group">
                    <label for="broker-name">Nombre *</label>
                    <input type="text" id="broker-name" required placeholder="Nombre completo">
                </div>

                <div class="form-group">
                    <label for="broker-company">Empresa</label>
                    <input type="text" id="broker-company" placeholder="Nombre de la empresa">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="broker-email">Email</label>
                        <input type="email" id="broker-email" placeholder="correo@ejemplo.com">
                    </div>
                    <div class="form-group">
                        <label for="broker-whatsapp">WhatsApp</label>
                        <input type="tel" id="broker-whatsapp" placeholder="+34 600 000 000">
                    </div>
                </div>

                <div class="form-group">
                    <label for="broker-status">Estado *</label>
                    <select id="broker-status" required>
                        <option value="nuevo">Nuevo</option>
                        <option value="contactado">Contactado</option>
                        <option value="procedimientos">Procedimientos</option>
                        <option value="cerrado">Cerrado</option>
                        <option value="perdido">Perdido</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="broker-notes">Notas</label>
                    <textarea id="broker-notes" rows="3" placeholder="Detalles importantes..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" id="cancel-broker-btn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL CONFIRMACI칍N BORRAR -->
    <div id="delete-modal" class="modal hidden">
        <div class="modal-content small-modal">
            <h3>쮼st치s seguro?</h3>
            <p>Esta acci칩n no se puede deshacer.</p>
            <div class="modal-actions">
                <button class="btn btn-outline" id="cancel-delete-btn">Cancelar</button>
                <button class="btn btn-danger" id="confirm-delete-btn">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- MODAL VENDOR -->
    <div id="vendor-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="vendor-modal-title">Nuevo Vendedor</h2>
            <form id="vendor-form">
                <input type="hidden" id="vendor-id">
                <div class="form-group">
                    <label>Nombre *</label>
                    <input type="text" id="vendor-name" required placeholder="Ej: Allianz, Sanitas...">
                </div>
                <div class="form-group">
                    <label>Categor칤a</label>
                    <input type="text" id="vendor-category" placeholder="Ej: Salud, Vida, Autos">
                </div>
                <div class="form-group">
                    <label>Contacto / Email</label>
                    <input type="text" id="vendor-contact" placeholder="soporte@empresa.com">
                </div>
                <div class="form-group">
                    <label>Web / Portal</label>
                    <input type="url" id="vendor-website" placeholder="https://...">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline close-modal-btn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL PROCEDURE -->
    <div id="procedure-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="procedure-modal-title">Nuevo Procedimiento</h2>
            <form id="procedure-form">
                <input type="hidden" id="procedure-id">

                <div class="form-group">
                    <label>T칤tulo *</label>
                    <input type="text" id="proc-title" required placeholder="Ej: Alta de P칩liza">
                </div>

                <div class="form-group">
                    <label>Vendedor *</label>
                    <select id="proc-vendor" required>
                        <option value="">Selecciona un vendedor...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Contenido / Pasos</label>
                    <textarea id="proc-content" rows="6"
                        placeholder="Describe los pasos del procedimiento..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-outline close-modal-btn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js?v=2.2"></script>
</body>

</html>