<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini CRM Broker v3.1</title>
    <link rel="stylesheet" href="style.css">
    <!-- Iconos -->
    <style>
        .active-lang {
            transform: scale(1.2);
            font-weight: bold;
            border-bottom: 2px solid var(--primary);
        }
    </style>
</head>

<body>

    <!-- Notificaciones / Toast -->
    <div id="toast-container"></div>

    <!-- SECCI√ìN DE AUTENTICACI√ìN -->
    <section id="auth-section" class="auth-container hidden">
        <div class="auth-card">
            <h1 id="auth-title" data-i18n="welcome_title">Bienvenido al CRM</h1>
            <p id="auth-message" data-i18n="welcome_msg">Por favor, configura tu contrase√±a de acceso.</p>

            <form id="auth-form">
                <div class="form-group">
                    <label for="password-input">Password</label>
                    <input type="password" id="password-input" required placeholder="***">
                </div>
                <button type="submit" class="btn btn-primary" id="auth-btn">OK</button>
            </form>
        </div>
    </section>

    <!-- SECCI√ìN PRINCIPAL DEL CRM -->
    <section id="app-section" class="app-container">

        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <h2>üöÄ CRM v3.6 - Admin Mode</h2>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-label" data-i18n="total_brokers">Total</span>
                    <span class="stat-value" id="total-brokers">0</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" id="export-btn" title="Exportar Backup" data-i18n="export">üíæ
                    Exportar</button>
                <button class="btn btn-secondary" id="import-btn-trigger" title="Importar Backup" data-i18n="import">üìÇ
                    Importar</button>
                <input type="file" id="import-file" accept=".json" style="display: none;">

                <div class="lang-toggle">
                    <select id="lang-selector" onchange="setLanguage(this.value)"
                        style="padding: 5px; border-radius: 5px; border: 1px solid #ddd; margin-right: 10px;">
                        <option value="es">üá™üá∏ Espa√±ol</option>
                        <option value="en">üá∫üá∏ English</option>
                        <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                    </select>
                </div>

                <div class="dropdown">
                    <button class="btn btn-outline" id="user-menu-btn" data-i18n="account">üë§ Cuenta</button>
                    <div class="dropdown-content hidden" id="user-menu">
                        <a href="#" id="logout-btn" data-i18n="logout">Cerrar Sesi√≥n</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="app-nav">
            <button class="nav-item active" data-view="dashboard" data-i18n="dashboard">üìä Tablero</button>
            <button class="nav-item" data-view="vendors" data-i18n="vendors">üè¢ Sellers</button>
            <button class="nav-item" data-view="procedures" data-i18n="procedures">üìÑ Procedimientos</button>
        </nav>

        <!-- VIEW: DASHBOARD (KANBAN) -->
        <div id="view-dashboard" class="view-container active">

            <!-- Toolbar -->
            <div class="toolbar">
                <div class="search-filter">
                    <input type="text" id="search-input" placeholder="üîç Buscar...">
                    <select id="filter-status" style="margin-left: 10px; padding: 5px;">
                        <option value="all">Todos los Estados</option>
                        <option value="nuevo">Nuevo</option>
                        <option value="contactado">Contactado</option>
                        <option value="procedimientos">Procedimientos</option>
                        <option value="cerrado">Cerrado</option>
                        <option value="perdido">Perdido</option>
                    </select>
                </div>
                <button class="btn btn-primary" id="add-broker-btn" data-i18n="new_broker">+ Nuevo Broker</button>
            </div>

            <!-- Kanban Board Area -->
            <main class="board" id="kanban-board">
                <!-- Columna: Nuevo -->
                <div class="column" data-status="nuevo" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="column-header status-nuevo">
                        <h3 data-i18n="status_nuevo">Nuevo</h3>
                        <span class="count" id="count-nuevo">0</span>
                    </div>
                    <div class="column-content" id="list-nuevo"></div>
                </div>

                <!-- Columna: Contactado -->
                <div class="column" data-status="contactado" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="column-header status-contactado">
                        <h3 data-i18n="status_contactado">Contactado</h3>
                        <span class="count" id="count-contactado">0</span>
                    </div>
                    <div class="column-content" id="list-contactado"></div>
                </div>

                <!-- Columna: Procedimientos -->
                <div class="column" data-status="procedimientos" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="column-header status-procedimientos">
                        <h3 data-i18n="status_procedimientos">Procedimientos</h3>
                        <span class="count" id="count-procedimientos">0</span>
                    </div>
                    <div class="column-content" id="list-procedimientos"></div>
                </div>

                <!-- Columna: Cerrado -->
                <div class="column" data-status="cerrado" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="column-header status-cerrado">
                        <h3 data-i18n="status_cerrado">Cerrado</h3>
                        <span class="count" id="count-cerrado">0</span>
                    </div>
                    <div class="column-content" id="list-cerrado"></div>
                </div>

                <!-- Columna: Perdido -->
                <div class="column" data-status="perdido" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="column-header status-perdido">
                        <h3 data-i18n="status_perdido">Perdido</h3>
                        <span class="count" id="count-perdido">0</span>
                    </div>
                    <div class="column-content" id="list-perdido"></div>
                </div>
            </main>
        </div>

        <!-- VIEW: VENDORS -->
        <div id="view-vendors" class="view-container hidden">
            <div class="toolbar">
                <input type="text" id="search-vendor" placeholder="üîç Buscar...">
                <button class="btn btn-primary" id="add-vendor-btn" data-i18n="new_vendor">+ Nuevo Seller</button>
            </div>
            <div class="grid-layout" id="vendors-list">
                <!-- Vendor Cards Generated via JS -->
            </div>
        </div>

        <!-- VIEW: PROCEDURES -->
        <div id="view-procedures" class="view-container hidden">
            <div class="toolbar">
                <div class="search-filter">
                    <input type="text" id="search-procedure" placeholder="üîç Buscar...">
                    <select id="filter-procedure-vendor">
                        <option value="all">All Sellers</option>
                    </select>
                </div>
                <button class="btn btn-primary" id="add-procedure-btn" data-i18n="new_procedure">+ Nuevo
                    Procedimiento</button>
            </div>
            <div class="list-layout" id="procedures-list"></div>
        </div>
    </section>

    <!-- MODAL BROKER -->
    <div id="broker-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="modal-title" data-i18n="modal_new_broker">Nuevo Broker</h2>
            <form id="broker-form">
                <input type="hidden" id="broker-id">

                <div class="form-group">
                    <label for="broker-name" data-i18n="lbl_name">Nombre *</label>
                    <input type="text" id="broker-name" required>
                </div>

                <div class="form-group">
                    <label for="broker-company" data-i18n="lbl_company">Empresa</label>
                    <input type="text" id="broker-company">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="broker-email" data-i18n="lbl_email">Email</label>
                        <input type="email" id="broker-email">
                    </div>
                    <div class="form-group">
                        <label for="broker-whatsapp" data-i18n="lbl_whatsapp">WhatsApp</label>
                        <input type="tel" id="broker-whatsapp">
                    </div>
                </div>

                <div class="form-group">
                    <label for="broker-status" data-i18n="lbl_status">Estado *</label>
                    <select id="broker-status" required>
                        <option value="nuevo">Nuevo</option>
                        <option value="contactado">Contactado</option>
                        <option value="procedimientos">Procedimientos</option>
                        <option value="cerrado">Cerrado</option>
                        <option value="perdido">Perdido</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="broker-notes" data-i18n="lbl_notes">Notas</label>
                    <textarea id="broker-notes" rows="3"></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-outline close-modal-btn"
                        data-i18n="btn_cancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary" data-i18n="btn_save">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL CONFIRMACI√ìN BORRAR -->
    <div id="delete-modal" class="modal hidden">
        <div class="modal-content small-modal">
            <h3 data-i18n="btn_delete">Eliminar</h3>
            <div class="modal-actions">
                <button class="btn btn-outline" id="cancel-delete-btn" data-i18n="btn_cancel">Cancelar</button>
                <button class="btn btn-danger" id="confirm-delete-btn" data-i18n="btn_delete">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- MODAL VENDOR -->
    <div id="vendor-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="vendor-modal-title" data-i18n="modal_new_vendor">Nuevo Seller</h2>
            <form id="vendor-form">
                <input type="hidden" id="vendor-id">
                <div class="form-group">
                    <label data-i18n="lbl_name">Nombre *</label>
                    <input type="text" id="vendor-name" required>
                </div>
                <div class="form-group">
                    <label data-i18n="lbl_category">Categor√≠a</label>
                    <input type="text" id="vendor-category">
                </div>
                <div class="form-group">
                    <label data-i18n="lbl_contact">Contacto / Email</label>
                    <input type="text" id="vendor-contact">
                </div>
                <div class="form-group">
                    <label data-i18n="lbl_web">Web / Portal</label>
                    <input type="url" id="vendor-website">
                </div>
                <div class="form-group">
                    <label data-i18n="lbl_mandate">Mandato de Ventas</label>
                    <input type="text" id="vendor-mandate">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline close-modal-btn"
                        data-i18n="btn_cancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary" data-i18n="btn_save">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL PROCEDURE -->
    <div id="procedure-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="procedure-modal-title" data-i18n="modal_new_procedure">Nuevo Procedimiento</h2>
            <form id="procedure-form">
                <input type="hidden" id="procedure-id">

                <div class="form-group">
                    <label data-i18n="lbl_title">T√≠tulo *</label>
                    <input type="text" id="proc-title" required>
                </div>

                <div class="form-group">
                    <label data-i18n="lbl_vendor">Vendedor *</label>
                    <select id="proc-vendor" required>
                        <option value="">...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label data-i18n="lbl_content">Contenido / Pasos</label>
                    <textarea id="proc-content" rows="6"></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-outline close-modal-btn"
                        data-i18n="btn_cancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary" data-i18n="btn_save">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="crm-app.js?v=3.6"></script>
</body>

</html>